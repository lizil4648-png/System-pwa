<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–°–∏—Å—Ç–µ–º–∞</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(180deg, #0a001f, #1a0033);
      color: #fff;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    header {
      padding: 20px;
      font-size: 28px;
      font-weight: bold;
      text-shadow: 0 0 15px #9f6cff;
    }
    nav {
      margin: 10px 0;
    }
    nav button {
      background: #2a0055;
      color: white;
      border: none;
      margin: 5px;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 10px;
      font-weight: bold;
    }
    nav button:hover {
      background: #4d00aa;
    }
    section { display: none; padding: 20px; }
    section.active { display: block; }

    .stats, .skills, .quests {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
    }
    .card {
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      padding: 15px;
      width: 200px;
      box-shadow: 0 0 10px #4d00aa;
    }

    .timer {
      margin-top: 10px;
      font-size: 14px;
    }

    /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å */
    .calendar-controls {
      margin-bottom: 15px;
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      max-width: 400px;
      margin: 0 auto;
    }
    .day {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.1);
      font-size: 12px;
    }
    .red { background: red; }
    .yellow { background: orange; }
    .blue { background: royalblue; }
    .green { background: green; }

    .year-view {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }
    .month-mini {
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 10px;
      padding: 5px;
    }
    .month-mini h4 { margin: 5px 0; font-size: 14px; }
    .mini-calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
    }
    .mini-day {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
    }
  </style>
</head>
<body>
  <header>üìñ –°–∏—Å—Ç–µ–º–∞</header>
  <nav>
    <button onclick="showSection('stats')">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
    <button onclick="showSection('skills')">–ù–∞–≤—ã–∫–∏</button>
    <button onclick="showSection('quests')">–ó–∞–¥–∞–Ω–∏—è</button>
    <button onclick="showSection('calendar')">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</button>
  </nav>

  <!-- –°—Ç–∞—Ç—ã -->
  <section id="stats" class="active">
    <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
    <div class="stats" id="statsList"></div>
  </section>

  <!-- –ù–∞–≤—ã–∫–∏ -->
  <section id="skills">
    <h2>–ù–∞–≤—ã–∫–∏</h2>
    <div class="skills" id="skillsList"></div>
  </section>

  <!-- –ó–∞–¥–∞–Ω–∏—è -->
  <section id="quests">
    <h2>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</h2>
    <div class="quests" id="questsList"></div>
  </section>

  <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
  <section id="calendar">
    <h2>–ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</h2>
    <div class="calendar-controls">
      <button onclick="switchCalendar('month')">–ú–µ—Å—è—Ü</button>
      <button onclick="switchCalendar('year')">–ì–æ–¥</button>
    </div>
    <div id="monthView"></div>
    <div id="yearView" style="display:none;"></div>
  </section>

  <script>
    // ===== –î–ê–ù–ù–´–ï =====
    const stats = {
      –°–∏–ª–∞: 0,
      –õ–æ–≤–∫–æ—Å—Ç—å: 0,
      –ñ–∏–≤—É—á–µ—Å—Ç—å: 0,
      –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç: 0,
      –î—É—Ö–æ–≤–Ω–æ—Å—Ç—å: 0
    };

    const skills = {
      "–§–∏–∑–∏–∫–∞": "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç",
      "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞": "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç",
      "–•–∏–º–∏—è": "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç",
      "–†—É–∫–æ–ø–∞—à–Ω—ã–π –±–æ–π": "–°–∏–ª–∞",
      "–ì–∏–±–∫–æ—Å—Ç—å": "–õ–æ–≤–∫–æ—Å—Ç—å",
      "–°–∫–æ—Ä–æ—Å—Ç—å": "–õ–æ–≤–∫–æ—Å—Ç—å",
      "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π": "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç",
      "–û—Ä–∞—Ç–æ—Ä—Å—Ç–≤–æ": "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç",
      "–ö–æ–ø–∏—Ä–∞–π—Ç–∏–Ω–≥": "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç",
      "–ù–µ–π—Ä–æ–Ω–∫–∞": "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç",
      "–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å": "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç",
      "–ò–∑—è—â–Ω–æ—Å—Ç—å": "–õ–æ–≤–∫–æ—Å—Ç—å",
      "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞": "–ñ–∏–≤—É—á–µ—Å—Ç—å",
      "–°—Ç—Ä–µ—Å—Å–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å": "–ñ–∏–≤—É—á–µ—Å—Ç—å",
      "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ": "–ñ–∏–≤—É—á–µ—Å—Ç—å",
      "–ö–æ—Ä–∞–Ω": "–î—É—Ö–æ–≤–Ω–æ—Å—Ç—å",
      "–ê“õ–∏–¥–∞": "–î—É—Ö–æ–≤–Ω–æ—Å—Ç—å",
      "–§–∏“õ—Ö": "–î—É—Ö–æ–≤–Ω–æ—Å—Ç—å",
      "–¢–∞—Å–∞—É—É—Ñ": "–î—É—Ö–æ–≤–Ω–æ—Å—Ç—å",
      "–†–∏—Å–æ–≤–∞–Ω–∏–µ": "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç",
      "–°–∫–æ—Ä–æ—á—Ç–µ–Ω–∏–µ": "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç",
      "–ß–∏—Å—Ç–æ–ø–ª–æ—Ç–Ω–æ—Å—Ç—å": "–ñ–∏–≤—É—á–µ—Å—Ç—å"
    };

    const fixedQuests = ["–§–∞–¥–∂—Ä –Ω–∞–º–∞–∑", "–ó—É—Ö—Ä –Ω–∞–º–∞–∑", "–ê—Å—Ä –Ω–∞–º–∞–∑", "–ú–∞–≥—Ä–∏–± –Ω–∞–º–∞–∑", "–ò—à–∞ –Ω–∞–º–∞–∑"];

    // ===== –•–†–ê–ù–ò–õ–ö–ê =====
    let data = JSON.parse(localStorage.getItem("systemData")) || { stats, progress:{} };

    function saveData() {
      localStorage.setItem("systemData", JSON.stringify(data));
    }

    // ===== –°–¢–ê–¢–´ =====
    function renderStats() {
      const list = document.getElementById("statsList");
      list.innerHTML = "";
      for (let s in data.stats) {
        let div = document.createElement("div");
        div.className = "card";
        div.textContent = `${s}: ${data.stats[s]}`;
        list.appendChild(div);
      }
    }

    // ===== –ù–ê–í–´–ö–ò + –¢–ê–ô–ú–ï–† =====
    let timers = {};
    function renderSkills() {
      const list = document.getElementById("skillsList");
      list.innerHTML = "";
      for (let sk in skills) {
        let div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `<b>${sk}</b><br>
          –°—Ç–∞—Ç: ${skills[sk]}<br>
          <button onclick="toggleTimer('${sk}')">–°—Ç–∞—Ä—Ç / –°—Ç–æ–ø</button>
          <div class="timer" id="timer-${sk}">00:00</div>`;
        list.appendChild(div);
      }
    }

    function toggleTimer(skill) {
      if (timers[skill]?.running) {
        // —Å—Ç–æ–ø
        timers[skill].running = false;
        let minutes = Math.floor((Date.now()-timers[skill].start)/60000);
        let stat = skills[skill];
        data.stats[stat] += Math.max(1, Math.floor(minutes/5));
        saveData();
        renderStats();
      } else {
        timers[skill] = { running:true, start: Date.now() };
        tick(skill);
      }
    }

    function tick(skill) {
      if (timers[skill]?.running) {
        let elapsed = Date.now()-timers[skill].start;
        let m = Math.floor(elapsed/60000);
        let s = Math.floor((elapsed%60000)/1000);
        document.getElementById("timer-"+skill).textContent =
          String(m).padStart(2,"0")+":"+String(s).padStart(2,"0");
        setTimeout(()=>tick(skill),1000);
      }
    }

    // ===== –ó–ê–î–ê–ù–ò–Ø =====
    function renderQuests() {
      const list = document.getElementById("questsList");
      list.innerHTML = "";
      let today = new Date().toDateString();
      if (!data.progress[today]) data.progress[today] = { quests:{} };

      // —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
      fixedQuests.forEach(q=>{
        addQuest(list,q,"–î—É—Ö–æ–≤–Ω–æ—Å—Ç—å",today);
      });

      // –∏–Ω–æ–≥–¥–∞ –æ—Ä–∞–∑–∞
      if (Math.random()<0.1) addQuest(list,"–û—Ä–∞–∑–∞","–î—É—Ö–æ–≤–Ω–æ—Å—Ç—å",today);

      // 2 —Å–ª—É—á–∞–π–Ω—ã—Ö –Ω–∞–≤—ã–∫–∞
      let keys = Object.keys(skills);
      for (let i=0;i<2;i++) {
        let rand = keys[Math.floor(Math.random()*keys.length)];
        addQuest(list,"–ü—Ä–∞–∫—Ç–∏–∫–∞: "+rand,skills[rand],today);
      }
    }

    function addQuest(list,name,stat,today) {
      let div = document.createElement("div");
      div.className = "card";
      let done = data.progress[today].quests[name];
      div.innerHTML = `<b>${name}</b><br>
        <button onclick="completeQuest('${today}','${name}','${stat}')">
          ${done?"–í—ã–ø–æ–ª–Ω–µ–Ω–æ":"–°–¥–µ–ª–∞—Ç—å"}
        </button>`;
      list.appendChild(div);
    }

    function completeQuest(day,name,stat) {
      data.progress[day].quests[name] = true;
      data.stats[stat] += 1;
      saveData();
      renderStats();
      renderQuests();
      renderMonthCalendar();
      renderYearCalendar();
    }

    // ===== –ö–ê–õ–ï–ù–î–ê–†–¨ =====
    function switchCalendar(mode) {
      document.getElementById("monthView").style.display = mode==="month"?"block":"none";
      document.getElementById("yearView").style.display = mode==="year"?"grid":"none";
    }

    function renderMonthCalendar() {
      let cont = document.getElementById("monthView");
      cont.innerHTML = "";
      let now = new Date();
      let year = now.getFullYear();
      let month = now.getMonth();
      let first = new Date(year,month,1);
      let last = new Date(year,month+1,0);
      let grid = document.createElement("div");
      grid.className = "calendar";
      for (let d=1; d<=last.getDate(); d++) {
        let day = new Date(year,month,d).toDateString();
        let div = document.createElement("div");
        div.className="day";
        div.textContent = d;
        let pct = getCompletion(day);
        div.classList.add(colorByPct(pct));
        grid.appendChild(div);
      }
      cont.appendChild(grid);
    }

    function renderYearCalendar() {
      let cont = document.getElementById("yearView");
      cont.innerHTML = "";
      let now = new Date();
      let year = now.getFullYear();
      for (let m=0;m<12;m++) {
        let wrap = document.createElement("div");
        wrap.className="month-mini";
        let h = document.createElement("h4");
        h.textContent = new Date(year,m).toLocaleString("ru",{month:"long"});
        wrap.appendChild(h);
        let grid = document.createElement("div");
        grid.className="mini-calendar";
        let days = new Date(year,m+1,0).getDate();
        for (let d=1;d<=days;d++) {
          let day = new Date(year,m,d).toDateString();
          let div = document.createElement("div");
          div.className="mini-day "+colorByPct(getCompletion(day));
          grid.appendChild(div);
        }
        wrap.appendChild(grid);
        cont.appendChild(wrap);
      }
    }

    function getCompletion(day) {
      if (!data.progress[day]) return 0;
      let quests = data.progress[day].quests;
      let total = Object.keys(quests).length;
      if (total===0) return 0;
      let done = Object.values(quests).filter(v=>v).length;
      return done/total;
    }

    function colorByPct(p) {
      if (p===0) return "";
      if (p<=0.2) return "red";
      if (p<=0.5) return "yellow";
      if (p<=0.8) return "blue";
      return "green";
    }

    // ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø =====
    function showSection(id) {
      document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    // ===== –ó–ê–ü–£–°–ö =====
    renderStats();
    renderSkills();
    renderQuests();
    renderMonthCalendar();
    renderYearCalendar();
  </script>
</body>
</html>
